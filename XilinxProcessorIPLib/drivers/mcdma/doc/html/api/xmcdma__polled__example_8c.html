<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mcdma: xmcdma_polled_example.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="HTML_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xlogo_bg.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mcdma
   </div>
   <div id="projectbrief">Xilinx SDK Drivers API Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('xmcdma__polled__example_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xmcdma_polled_example.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Overview</h2>
<div class="textblock"><p>This file demonstrates how to use the mcdma driver on the Xilinx AXI MCDMA core (AXI MCDMA) to transfer packets in polling mode. </p>
<p>This examples shows how to do multiple packets and multiple BD's per packet transfers.</p>
<p>H/W Requirements: In order to test this example at the h/w level AXI MCDMA MM2S should connect with the S2MM.</p>
<p>System level Considerations for Zynq UltraScale+ designs: On ZU+ MPSOC for PL IP's 3 different ports are available HP, HPC and ACP.</p>
<p>The explanation below talks about HPC and HP port.</p>
<p>HPC design considerations: ZU+ MPSOC has in-built cache coherent interconnect(CCI) to take care of Coherency through HPC port. Following needs to be done by the users before running the examples. 1) Snooping should be enabled in the S3 (0xFD6E4000) 2) Mark the DDR memory being used for buffers as outer sharable. To do that please modify baremetal bsp file translation_table.S. Change .set Memory, 0x405 | (3 &lt;&lt; 8) | (0x0). to .set Memory, 0x405 | (2 &lt;&lt; 8) | (0x0).</p>
<p>Please uncomment below define for HPC design so that application won't do Any cache flush/invalidation.</p>
<p>//#define HPC_DESIGN</p>
<p>It is recomended to use HPC to make use of H/W coherency feature.</p>
<p>HP design considerations: The example uses un-cached memory for buffer descriptors and uses Normal memory for buffers..</p>
<p>A53 does not provide separate instruction for cache invalidation. It supports flush (clean + invalidation). Before a DMA starts, Application is expected to do a cache flush for the relevant memory. Once DMA ends, the data can simply be read from memory. However, there will be occasions when A53 L1 cache system can prefetch Memory locations which were earlier flushed. On such scenarios there is High probability that CPU reads memory from cache and DMA is still not Complete for this memory. This leads lost coherency between cache and Memory. Subsequent data verification(after DMA is complete) thus fails.</p>
<p>It is generally an unpredictable behavior. It is highly unlikely to happen For a single buffer usecase. But for multiple buffers staying in adjacent Cache locations,There is a high probability that users can get into such Failures.</p>
<p>The L1 prefetch is a feature of the L1 cache system for improving performance. The L1 cache has its own algorithm to prefetch. The prefetch stops when: -&gt; the memory accesses cross a 4KB page boundary. -&gt; a dsb or PRFM instruction is executed. -&gt; the program execution does not hit the prefetched data lines.</p>
<p>Accordingly the solution for the above problem is:</p>
<p>1) Use dsb The location of the dsb is crucial. The programmer needs to predict the Maximum probability when the L1 prefetch will happen for relevant DMA Addresses.It will be typically in the DMA done interrupt (where the Data verification happens for a buffer).The cache line size is 64 bytes. The prefetch obviously will happen in chunks of 64 bytes.</p>
<p>However, because of the unpredictability nature of the prefetch, it is Difficult to find out the exact point of dsb.To be at a safer side, The dsb can be put for every memory location fetched.</p>
<p>There will be heavy performance penalty. Every dsb clears the store Buffers. Executing dsbs very frequently will degrade the performance Significantly.</p>
<p>2) Disable Prefetch of L1 Cahe This can be done by setting the CPUACTLR_EL1 register.</p>
<p>3) Put buffers from 4k apart</p>
<pre>
MODIFICATION HISTORY:</pre><pre>Ver   Who  Date       Changes
----- ---- --------   -------------------------------------------------------
1.0      adk  18/07/2017 Initial Version.
1.2      rsp  07/19/2018 Read channel count from IP config.
      rsp  08/17/2018 Fix typos and rephrase comments.
      rsp  08/17/2018 Read Length register value from IP config.
</pre><hr/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xmcdma__polled__example_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:a840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function.  <a href="#a840291bc02cba5474a4cb46a9b9566fe">More...</a><br /></td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main function. </p>
<p>This function is the main entry of the tests on DMA core. It sets up DMA engine to be ready to receive and send packets, then a packet is transmitted and will be verified after it is received via the DMA.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS if test passes</li>
<li>XST_FAILURE if test fails.</li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>None. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright &copy; 2015 Xilinx Inc. All rights reserved.</li>
  </ul>
</div>
</body>
</html>
