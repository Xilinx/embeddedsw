// Copyright (C) 2024 - 2025 Advanced Micro Devices, Inc. All Rights Reserved.
#ifndef __XYLON_FMC_9296_H__
#define __XYLON_FMC_9296_H__


#include <isi_fmc.h>
#include "hal_i2c.h"

#define YUV_SENSOR

#define MAX929X_TABLE_END			(0xffff)
#define MAX929X_TABLE_WAIT      	(0xfffe)
#define MAX929X_TABLE_WAIT_MS    	(210)

RegI2CT Des1_init[] = {
};

RegI2CT Des7_init[] = {
	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	//Steam ID
	{0x0050, 0x00},
	{0x0051, 0x01},
	{0x0052, 0x02},
	{0x0053, 0x03},

	//Back Top
	{0x0320, 0x2F},
	{0x0323, 0x20},
	{0x0316, 0xAC},		//Data Type changed for 5MP-RGBIR (12bit to 10bit)
	{0x0317, 0xBB},
	{0x0318, 0xB0},
	{0x0319, 0x6A},
	{0x0313, 0x62},
	{0x031A, 0x30},

	//MIPI PHY
	{0x0333, 0x1E},		//MIPI 3
	{0x040A, 0x10},
	{0x044A, 0xD0},		//lane selection and VC
	{0x048A, 0x10},
	{0x04CA, 0x10},
	{0x044B, 0x07},
	{0x046D, 0x15},
	{0x044D, 0x2B},
	{0x044E, 0x2B},
	{0x044F, 0x00},
	{0x0450, 0x00},
	{0x0451, 0x01},
	{0x0452, 0x01},
	{0x048B, 0x07},
	{0x04AD, 0x15},
	{0x048D, 0x2C},
	{0x048E, 0x6C},
	{0x048F, 0x00},
	{0x0490, 0x40},
	{0x0491, 0x01},
	{0x0492, 0x41},

	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	{MAX929X_TABLE_END, 0}
};

//below is of LEO
RegI2CT Des2_init[] = {
	//{0x0010, 0x01},
	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	//Steam ID
	{0x0050, 0x00},
	{0x0051, 0x01},
	{0x0052, 0x02},
	{0x0053, 0x03},


	//Back Top
	{0x0320, 0x2f}, //2f  188, 23  39
	{0x0323, 0x20},
	{0x0316, 0xAC},			//Data Type
	{0x0317, 0xBC},
	{0x0318, 0xB0},
	{0x0319, 0x6C},
	{0x0313, 0x62},
	{0x031A, 0x30},

	//MIPI PHY
	{0x0333, 0x1E},		//MIPI 3
	{0x040A, 0x10},
	{0x044A, 0xD0},		//lane selection and VC
	{0x048A, 0x10},
	{0x04CA, 0x10},
	{0x044B, 0x07},
	{0x046D, 0x15},
	{0x044D, 0x2C},
	{0x044E, 0x2C},
	{0x044F, 0x00},
	{0x0450, 0x00},
	{0x0451, 0x01},
	{0x0452, 0x01},
	{0x048B, 0x07},
	{0x04AD, 0x15},
	{0x048D, 0x2C},
	{0x048E, 0x6C},
	{0x048F, 0x00},
	{0x0490, 0x40},
	{0x0491, 0x01},
	{0x0492, 0x41},

	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	{MAX929X_TABLE_END, 0}
};

// Device initialization structures //
RegI2CT Des3_init[] = {
	//MIPI_5
	/*
	 * Sumit
	 *Doing Register - 0x10 Configuration from code itself
	 */
	//	{0x0010,0x22},
	{0x0050, 0x00},
	{0x0051, 0x01},
	{0x0052, 0x02},
	{0x0053, 0x03},


	{0x0320, 0x2F},
	{0x0323, 0x2F}, /*Amit :  csi2 - controller 2 - csi 2 */
	{0x0316, 0xAC},
	{0x0317, 0xBC},
	{0x0318, 0xB0},
	{0x0319, 0x6C},
	{0x0313, 0x62},
	{0x031A, 0x30},
	{0x0333, 0x1E},
	//{0x0334,0xE4}, /*Amit :port b lane check -- */
	{0x0334, 0xE1},
	{0x040A, 0xD0},
	{0x044A, 0xD0},
	{0x048A, 0xD0}, // Amit : data lanes to 4 for pipe y
	{0x04CA, 0xD0},
	{0x044B, 0x07},
	{0x046D, 0x15},
	/* Amit */
	//{0x046D, 0x2A},  // Amit: to route to csi controller)
	//VC and DT Mapping Register
	{0x044D, 0x2C},		//VC and DT
	{0x044E, 0x2C},
	/* pipe Y source and destination map */
	{0x044F, 0x00},
	{0x0450, 0x00},
	{0x0451, 0x01},
	{0x0452, 0x01},
	//VC and DT Mapping Register END
	{0x048B, 0x07},
	// {0x04AD,0x15},
	{0x04AD, 0x2A}, /*Amit */

	/* Amit: Changes to roture data to csi controller port  */
	/*
	   {0x048D,0x2C},
	   {0x048E,0x6C},

	   {0x048F,0x00},
	   {0x0490,0x40},
	   {0x0491,0x01},
	   {0x0492,0x41},*/

	{0x048D, 0x2C},
	{0x048E, 0x2C},
	{0x048F, 0x00},
	{0x0490, 0x00},
	{0x0491, 0x01},
	{0x0492, 0x01},
	{0x001c, 0xff}
};

RegI2CT Des4_init[] = {
};

RegI2CT Des5_init[] = {
	//MIPI_
	/*
	 * Sumit
	 *Doing Register - 0x10 Configuration from code itself
	 */
	//	{0x0010,0x22},

	{0x0050, 0x00},
	{0x0051, 0x01},
	{0x0052, 0x02},
	{0x0053, 0x03},

	{0x0320, 0x2F},
	{0x0323, 0x2F}, /*Amit :  csi2 - controller 2 - csi 2 */

	{0x0316, 0xAC},
	{0x0317, 0xBC},
	{0x0318, 0xB0},
	{0x0319, 0x6C},
	{0x0313, 0x62},
	{0x031A, 0x30},

	{0x0333, 0x1E},
	//{0x0334,0xE4}, /*Amit :port b lane check -- */
	{0x0334, 0xE1},

	{0x040A, 0xD0},

	{0x044A, 0xD0},
	{0x048A, 0xD0}, // Amit : data lanes to 4 for pipe y

	{0x04CA, 0xD0},

	{0x044B, 0x07},
	{0x046D, 0x15},

	/* Amit */
	//{0x046D, 0x2A},  // Amit: to route to csi controller)
	//VC and DT Mapping Register
	{0x044D, 0x2C},		//VC and DT
	{0x044E, 0x2C},

	/* pipe Y source and destination map */
	{0x044F, 0x00},
	{0x0450, 0x00},

	{0x0451, 0x01},
	{0x0452, 0x01},
	//VC and DT Mapping Register END

	{0x048B, 0x07},
	// {0x04AD,0x15},
	{0x04AD, 0x2A}, /*Amit */

	/* Amit: Changes to roture data to csi controller port  */
	/*
	   {0x048D,0x2C},
	   {0x048E,0x6C},

	   {0x048F,0x00},
	   {0x0490,0x40},
	   {0x0491,0x01},
	   {0x0492,0x41},*/

	{0x048D, 0x2C},
	{0x048E, 0x2C},

	{0x048F, 0x00},
	{0x0490, 0x00},
	{0x0491, 0x01},
	{0x0492, 0x01},

	{0x001c, 0xff}
};

RegI2CT Des6_init[] = {
	//{0x0010, 0x01},
	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	//Steam ID
	{0x0050, 0x00},
	{0x0051, 0x01},
	{0x0052, 0x02},
	{0x0053, 0x03},
	//Back Top
	{0x0320, 0x2f}, //2f  188, 23  39
	{0x0323, 0x20},
	{0x0316, 0xAC},			//Data Type
	{0x0317, 0xBC},
	{0x0318, 0xB0},
	{0x0319, 0x6C},
	{0x0313, 0x62},
	{0x031A, 0x30},
	//MIPI PHY
	{0x0333, 0x1E},		//MIPI 3
	{0x040A, 0x10},
	{0x044A, 0xD0},		//lane selection and VC
	{0x048A, 0x10},
	{0x04CA, 0x10},
	{0x044B, 0x07},
	{0x046D, 0x15},
	{0x044D, 0x2C},
	{0x044E, 0x2C},
	{0x044F, 0x00},
	{0x0450, 0x00},
	{0x0451, 0x01},
	{0x0452, 0x01},
	{0x048B, 0x07},
	{0x04AD, 0x15},
	{0x048D, 0x2C},
	{0x048E, 0x6C},
	{0x048F, 0x00},
	{0x0490, 0x40},
	{0x0491, 0x01},
	{0x0492, 0x41},
	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	{MAX929X_TABLE_END, 0}
};

RegI2CT Des2_revserse_splitter_init[] = {
	// {0x0010, 0x01},
	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	//Steam ID
	{0x0050, 0x00},
	{0x0051, 0x01},		//MIPI-2 data
	{0x0052, 0x02},		//MIPI-3 DATA
	{0x0053, 0x03},
	//Back Top

	{0x0320, 0x2F},			//software override bit
	{0x0323, 0x20},			//No Idesa
	{0x0316, 0xAC},			//Data Type
	{0x0317, 0xBC},
	{0x0318, 0xB0},
	{0x0319, 0x6C},
	{0x0313, 0x62},
	{0x031A, 0x30},

	//MIPI PHY -Register
	{0x0333, 0x1E},
	//Not Available
	{0x040A, 0x10},
	//Pipe Y -MIPI TX1 ,register space
	//lane selection and VC    lane selection 4 and VC disabled
	{0x044A, 0xD0},

	// {0x048A, 0x10}, Same reg but for z ,we will add latter

	//Not Available
	{0x04CA, 0x10},
	//MAP ENABLE src and dst reg
	{0x044B, 0x07},
	//Route to csi controller
	{0x046D, 0x15},
	//Map_SRC_0 to MAP_DST_0
	{0x044D, 0x2C},
	{0x044E, 0x2C},
	//Map_SRC_1 to MAP_DST_1
	{0x044F, 0x00},
	{0x0450, 0x00},
	//Map_SRC_2 to MAP_DST_2
	{0x0451, 0x01},
	{0x0452, 0x01},

	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},

	/* pipe Y source and destination map */
	/* Amit */
	{0x048A, 0xD0}, //data lanes to 4 for pipe y
	/*Sumit :For Z Pipe routed to port A  */

	//This route to csi port for z
	//MAP_EN_L for TX2/z
	{0x048B, 0x07},

	// Changing dphy from 1 to 0 for z filter
	{0x04AD, 0x15},
	//	{0x04AD,0x00},
	/*
	 * 	FOR Z pipe below config
	 * 	Map_SRC_0 to MAP_DST_0
	 */
	{0x048D, 0x2C},
	{0x048E, 0x6C},
	//	{0x048E,0x2C},
	//Map_SRC_1 to MAP_DST_1
	{0x048F, 0x00},
	{0x0490, 0x40},
	//Map_SRC_2 to MAP_DST_2
	{0x0491, 0x01},
	{0x0492, 0x41},

	{0x001c, 0xff},

	{MAX929X_TABLE_WAIT, MAX929X_TABLE_WAIT_MS},
	{MAX929X_TABLE_END, 0}
};

static int xylon_IsiCreateFmcIss();
static int xylon_Fmc_Setup(int des_arr_id);
static int xylon_Deser_setup();
static int xylon_Deser_Enable(u8 pos) ;
static int xylon_Deser_Disable(u8 pos);

typedef struct Xylon_Context_s {
	int num_of_serailizer;
	int num_of_deserializer;
	int SlaveAddress;
} Xylon_Context_t;

#endif
