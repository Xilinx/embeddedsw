# Makefile generated by Xilinx HSM.

PROCESSOR = ps7_cortexa9_0
LIBRARIES = ${PROCESSOR}/lib/libxil.a
BSP_MAKEFILES := $(wildcard $(PROCESSOR)/libsrc/*/src/Makefile)
SUBDIRS := $(patsubst %/Makefile, %, $(BSP_MAKEFILES))
CC	:= arm-xilinx-eabi-gcc
AR	:= arm-xilinx-eabi-ar
C_FLAGS	:= -O2 -c
EC_FLAGS	:= -g

all: libs
	@echo 'Finished building libraries'

include: $(addsuffix /make.include,$(SUBDIRS))

libs: $(addsuffix /make.libs,$(SUBDIRS))

$(PROCESSOR)/lib/libxil.a: $(PROCESSOR)/lib/libxil_init.a
	cp -f $< $@

%/make.include: $(if $(wildcard $(PROCESSOR)/lib/libxil_init.a),$(PROCESSOR)/lib/libxil.a,)
	@echo "Running Make include in $(subst /make.include,,$@)"
	$(MAKE) -C $(subst /make.include,,$@) -s include "COMPILER=$(CC)" "ARCHIVER=$(AR)" "COMPILER_FLAGS=$(C_FLAGS)" "EXTRA_COMPILER_FLAGS=$(EC_FLAGS)"

%/make.libs: include
	@echo "Running Make libs in $(subst /make.libs,,$@)"
	$(MAKE) -C $(subst /make.libs,,$@) -s libs "COMPILER=$(CC)" "ARCHIVER=$(AR)" "COMPILER_FLAGS=$(C_FLAGS)" "EXTRA_COMPILER_FLAGS=$(EC_FLAGS)"

clean:
	rm -f ${PROCESSOR}/lib/libxil.a
