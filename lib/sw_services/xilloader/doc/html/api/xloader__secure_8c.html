<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>xilloader: xloader_secure.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="HTML_custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xlogo_bg.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">xilloader
   </div>
   <div id="projectbrief">Vitis Drivers API Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="globals.html"><span>APIs</span></a></li>
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('xloader__secure_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xloader_secure.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Overview</h2>
<div class="textblock"><p>This file contains all common security operations including sha related code. </p>
<pre>
MODIFICATION HISTORY:</pre><pre>Ver   Who  Date     Changes
----- ---- -------- -------------------------------------------------------
1.00  vns  04/23/19 First release
1.01  vns  05/13/19 Added grey key decryption support
      vns  06/14/19 Removed SHA padding related code
      vns  07/09/19 Added PPK and SPK integrity checks
                    Updated chunk size for secure partition
                    Added encryption + authentication support
      vns  07/23/19 Added functions to load secure headers
      vns  08/23/19 Added buffer cleaning on failure
                    Added different key sources support
                    Added header decryption support
                    Set hardware into reset upon failure
      sb   08/24/19  Fixed coverity warnings
      har  08/26/19 Fixed MISRA C violations
      vns  08/28/19 Fixed bug in loading bigger secure CDOs
1.02  vns  02/23/20 Added DPA CM enable/disable functionality
      vns  02/26/20 Added encryption revoke checks
                    Added DEC_ONLY checks
                    Updated PDI fields
                    Added DPA CM enable/disable for MetaHeader
      har  02/24/20 Added code to return error codes
      rpo  02/25/20 Added SHA, RSA, ECDSA, AES KAT support
      vns  03/01/20 Added PUF KEK decrypt support
      ana  04/02/20 Added crypto engine KAT test function calls
                    Removed release reset function calls from this file
                    and added in respective library files
      bsv  04/07/20 Change DMA name to PMCDMA
      vns  04/13/20 Moved Aes instance to Secure structure
1.03  ana  06/04/20 Minor Enhancement and updated Sha3 hash buffer
                    with XSecure_Sha3Hash Structure
      tar  07/23/20 Fixed MISRA-C required violations
      skd  07/29/20 Updated device copy macros
      kpt  07/30/20 Added Meta header IV range checks and added IV
                    support for ENC only case
      kpt  08/01/20 Corrected check to validate the last row of ppk hash
      bsv  08/06/20 Added delay load support for secure cases
      kpt  08/10/20 Corrected endianness for meta header IV range checking
      har  08/11/20 Added support for authenticated JTAG
      td   08/19/20 Fixed MISRA C violations Rule 10.3
      kal  08/23/20 Added parallel DMA support for Qspi and Ospi for secure
      har  08/24/20 Added support for ECDSA P521 authentication
      kpt  08/27/20 Changed argument type from u8* to UINTPTR for SHA
      kpt  09/07/20 Fixed key rolling issue
      kpt  09/08/20 Added redundancy at security critical checks
      rpo  09/10/20 Added return type for XSecure_Sha3Start
      bsv  09/30/20 Renamed XLOADER_CHUNK_MEMORY to XPLMI_PMCRAM_CHUNK_MEMORY
      har  09/30/20 Deprecated Family Key support
      bm   09/30/20 Added SecureClear API to clear security critical data
                    in case of exceptions and also place AES, ECDSA_RSA,
                    SHA3 in reset
      kal  10/07/20 Added Missed DB check in XLoader_RsaSignVerify API
      kal  10/16/20 Added a check for RSA EM MSB bit to make sure it is zero
      kpt  10/19/20 Code clean up
      td   10/19/20 MISRA C Fixes
      bsv  10/19/20 Parallel DMA related changes
      har  10/19/20 Replaced ECDSA in function calls
1.04  har  11/12/20 Initialized GVF in PufData structure with MSB of shutter
                    value
                    Improved checks for sync in PDI DPACM Cfg and Efuse DPACM Cfg
      bm   12/16/20 Added PLM_SECURE_EXCLUDE macro. Also moved authentication and
                    encryption related code to <a class="el" href="xloader__auth__enc_8c.html" title="This file contains authentication and encryption related code. ">xloader_auth_enc.c</a> file
      bm   01/04/21 Updated checksum verification to be done at destination memory
      kpt  02/18/21 Fixed logical error in partition next chunk copy in encryption cases
1.05  har  03/17/21 Added API to set the secure state of device
      ma   03/24/21 Minor updates to prints in XilLoader
      bm   05/10/21 Updated chunking logic for hashes
      bm   05/13/21 Updated code to use common crypto instances from xilsecure
      ma   05/18/21 Minor code cleanup
      ma   05/20/21 Fix warnings introduced due to volatile qualifier
      har  05/20/21 Added checks in case both efuse auth and bh auth are enabled
1.06  td   07/08/21 Fix doxygen warnings
      har  07/15/21 Fixed doxygen warnings
      har  07/27/21 Added prints for Secure State
      kpt  08/11/21 Added redundant check for Xil_MemCmp in
                    XLoader_VerifyHashNUpdateNext
      bsv  08/17/21 Code clean up
      bsv  08/31/21 Code clean up
      kpt  09/09/21 Fixed SW-BP-BLIND-WRITE in XLoader_SecureClear
      kpt  09/09/21 Fixed SW-BP-BLIND-WRITE in XLoader_AuthEncClear
      kpt  09/15/21 Fixed SW-BP-INIT-FAIL in XLoader_GetAHWRoT
      kpt  09/15/21 Fixed SW-BP-INIT-FAIL in XLoader_GetSHWRoT
      kpt  09/18/21 Fixed SW-BP-REDUNDANCY
      kpt  09/20/21 Fixed checksum issue in case of delay load
      bsv  10/01/21 Addressed code review comments
1.07  kpt  10/07/21 Decoupled checksum functionality from secure code
      kpt  10/20/21 Modified temporal checks to use temporal variables from
                    data section
      bsv  10/26/21 Code clean up
      kpt  10/28/21 Added flags in XLoader_SecureInit to indicate the mode of
                    copy
1.08  skd  11/18/21 Added time stamps in XLoader_ProcessChecksumPrtn
      kpt  12/13/21 Replaced standard library utility functions with secure
                    functions
      bsv  02/09/22 Code clean up to reduce size
      bsv  02/09/22 Code clean up
      bsv  02/10/22 Code clean up by removing unwanted initializations
      bsv  02/14/22 Added comments for better readability
      kpt  02/18/22 Fixed copy to memory issue
1.09  bm   07/06/22 Refactor versal and versal_net code
      sk   10/19/22 Fix security review comments
      har  11/17/22 Removed XLoader_CheckNonZeroPpk and moved code to set
                    Secure State(Auth) in xloader_plat_secure files
      ng   11/23/22 Updated doxygen comments
      kpt  02/21/23 Fixed bug in XLoader_SecureClear
      ng   03/30/23 Updated algorithm and return values in doxygen comments
      sk   05/18/23 Deprecate copy to memory feature
      yog  07/17/23 Added check for returning glitch error for XLoader_ChecksumInit API
      ng   07/10/23 Added support for system device-tree flow
      yog  08/17/23 Added a check to return error when secure is excluded
                    and trying to do secure boot</pre><pre></pre><dl class="section note"><dt>Note</dt><dd></dd></dl>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae1ad484f4b4344573008a1fa138ad597"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#ae1ad484f4b4344573008a1fa138ad597">XLOADER_SHA3_RESET_REG</a>&#160;&#160;&#160;(0xF1210004U)</td></tr>
<tr class="memdesc:ae1ad484f4b4344573008a1fa138ad597"><td class="mdescLeft">&#160;</td><td class="mdescRight">SHA3 Reset register address.  <a href="#ae1ad484f4b4344573008a1fa138ad597">More...</a><br/></td></tr>
<tr class="separator:ae1ad484f4b4344573008a1fa138ad597"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18a802ef19167e4a011890ac7bf61f7d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a18a802ef19167e4a011890ac7bf61f7d">XLOADER_SHA3_RESET_VAL</a>&#160;&#160;&#160;(0x1U)</td></tr>
<tr class="memdesc:a18a802ef19167e4a011890ac7bf61f7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">SHA3 Reset value.  <a href="#a18a802ef19167e4a011890ac7bf61f7d">More...</a><br/></td></tr>
<tr class="separator:a18a802ef19167e4a011890ac7bf61f7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9410756c2dbe4b6bd6cdfce81a5bd7fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a9410756c2dbe4b6bd6cdfce81a5bd7fa">XLoader_SecureInit</a> (XLoader_SecureParams *SecurePtr, XilPdi *PdiPtr, u32 PrtnNum)</td></tr>
<tr class="memdesc:a9410756c2dbe4b6bd6cdfce81a5bd7fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function initializes XLoader_SecureParams's instance.  <a href="#a9410756c2dbe4b6bd6cdfce81a5bd7fa">More...</a><br/></td></tr>
<tr class="separator:a9410756c2dbe4b6bd6cdfce81a5bd7fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04bdca8398a9278a9c382ef66ad42ed9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a04bdca8398a9278a9c382ef66ad42ed9">XLoader_SecureCopy</a> (XLoader_SecureParams *SecurePtr, u64 DestAddr, u32 Size)</td></tr>
<tr class="memdesc:a04bdca8398a9278a9c382ef66ad42ed9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function loads secure non-cdo partitions.  <a href="#a04bdca8398a9278a9c382ef66ad42ed9">More...</a><br/></td></tr>
<tr class="separator:a04bdca8398a9278a9c382ef66ad42ed9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9171035e129091fbaddbc27756381f76"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a9171035e129091fbaddbc27756381f76">XLoader_SecureClear</a> (void)</td></tr>
<tr class="memdesc:a9171035e129091fbaddbc27756381f76"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is called to clear secure critical data in case of exceptions.  <a href="#a9171035e129091fbaddbc27756381f76">More...</a><br/></td></tr>
<tr class="separator:a9171035e129091fbaddbc27756381f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5054d79a7dcc052ae83d997f183c8779"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a5054d79a7dcc052ae83d997f183c8779">XLoader_SecureChunkCopy</a> (XLoader_SecureParams *SecurePtr, u64 SrcAddr, u8 Last, u32 BlockSize, u32 TotalSize)</td></tr>
<tr class="memdesc:a5054d79a7dcc052ae83d997f183c8779"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function copies the data from SrcAddr to chunk memory during processing of secure partitions.  <a href="#a5054d79a7dcc052ae83d997f183c8779">More...</a><br/></td></tr>
<tr class="separator:a5054d79a7dcc052ae83d997f183c8779"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e5d053bbf2e5283aac4b2a1e860b44d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a4e5d053bbf2e5283aac4b2a1e860b44d">XLoader_CheckNonZeroPpk</a> (void)</td></tr>
<tr class="memdesc:a4e5d053bbf2e5283aac4b2a1e860b44d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function checks if PPK is programmed.  <a href="#a4e5d053bbf2e5283aac4b2a1e860b44d">More...</a><br/></td></tr>
<tr class="separator:a4e5d053bbf2e5283aac4b2a1e860b44d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e99458db1239a8f1bcb70eee9025232"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a3e99458db1239a8f1bcb70eee9025232">XLoader_GetAHWRoT</a> (const u32 *AHWRoTPtr)</td></tr>
<tr class="memdesc:a3e99458db1239a8f1bcb70eee9025232"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the state of authenticated boot.  <a href="#a3e99458db1239a8f1bcb70eee9025232">More...</a><br/></td></tr>
<tr class="separator:a3e99458db1239a8f1bcb70eee9025232"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27d4a7f2cecd7b051a5418ad7586cac3"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a27d4a7f2cecd7b051a5418ad7586cac3">XLoader_GetSHWRoT</a> (const u32 *SHWRoTPtr)</td></tr>
<tr class="memdesc:a27d4a7f2cecd7b051a5418ad7586cac3"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the state of encrypted boot.  <a href="#a27d4a7f2cecd7b051a5418ad7586cac3">More...</a><br/></td></tr>
<tr class="separator:a27d4a7f2cecd7b051a5418ad7586cac3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade5fc1ce6a279c921672d5692df5cf56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#ade5fc1ce6a279c921672d5692df5cf56">XLoader_SetSecureState</a> (void)</td></tr>
<tr class="memdesc:ade5fc1ce6a279c921672d5692df5cf56"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads the value of PPK efuse bits, DEC only efuse bits and fields in bootheader and accordingly sets the Secure State of boot.  <a href="#ade5fc1ce6a279c921672d5692df5cf56">More...</a><br/></td></tr>
<tr class="separator:ade5fc1ce6a279c921672d5692df5cf56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31df7acaead3af0dfa1735979d3cee12"><td class="memItemLeft" align="right" valign="top">XLoader_SecureTempParams *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams</a> (void)</td></tr>
<tr class="memdesc:a31df7acaead3af0dfa1735979d3cee12"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the pointer to XLoader_SecureTempParams.  <a href="#a31df7acaead3af0dfa1735979d3cee12">More...</a><br/></td></tr>
<tr class="separator:a31df7acaead3af0dfa1735979d3cee12"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ae1ad484f4b4344573008a1fa138ad597"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_SHA3_RESET_REG&#160;&#160;&#160;(0xF1210004U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SHA3 Reset register address. </p>

<p>Referenced by <a class="el" href="xloader__secure_8h.html#a9171035e129091fbaddbc27756381f76">XLoader_SecureClear()</a>.</p>

</div>
</div>
<a class="anchor" id="a18a802ef19167e4a011890ac7bf61f7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XLOADER_SHA3_RESET_VAL&#160;&#160;&#160;(0x1U)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SHA3 Reset value. </p>

<p>Referenced by <a class="el" href="xloader__secure_8h.html#a9171035e129091fbaddbc27756381f76">XLoader_SecureClear()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a4e5d053bbf2e5283aac4b2a1e860b44d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_CheckNonZeroPpk </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function checks if PPK is programmed. </p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_GLITCH_DETECTED if glitch is detected.</li>
<li>XST_FAILURE on failure. </li>
</ul>
</dd></dl>
<ul>
<li>Check if any of the PPK efuses are not programmed. </li>
</ul>

<p>References <a class="el" href="xloader__secure_8h.html#a9c37bf573525769b2821bf9c45858c08">XLOADER_EFUSE_PPK0_START_OFFSET</a>, and <a class="el" href="xloader__secure_8h.html#a37961c447b4a134f280d82ef4e8b542e">XLOADER_EFUSE_PPK2_END_OFFSET</a>.</p>

<p>Referenced by <a class="el" href="xloader__plat__secure_8c.html#ab971c3f4e75170b57d1f5fdcd51cc092">XLoader_CheckSecureStateAuth()</a>.</p>

</div>
</div>
<a class="anchor" id="a3e99458db1239a8f1bcb70eee9025232"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 XLoader_GetAHWRoT </td>
          <td>(</td>
          <td class="paramtype">const u32 *&#160;</td>
          <td class="paramname"><em>AHWRoTPtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the state of authenticated boot. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">AHWRoTPtr</td><td>- Always NULL except at time of initialization of SecureStateAHWRoT variable</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XPLMI_RTCFG_SECURESTATE_AHWROT - PPK fuses are programmed</li>
<li>XPLMI_RTCFG_SECURESTATE_EMUL_AHWROT - BHDR auth is enabled</li>
<li>XPLMI_RTCFG_SECURESTATE_NONSECURE - Neither PPK fuses are programmed nor BH auth is enabled </li>
</ul>
</dd></dl>
<ul>
<li>If AHWRoTPtr is not NULL, then set the SecureStateSHWRoT. Otherwise return the previous stored Secure state.</li>
</ul>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#a434f49bc94a9078a86451ac5bde637cc">XLoader_AddAuthJtagToScheduler()</a>, <a class="el" href="net_2xloader__plat__secure_8h.html#a331850d019d28f888cfa3499be80529d">XLoader_AddDeviceStateChangeToScheduler()</a>, <a class="el" href="xloader__auth__enc_8h.html#a9df696fd17dec50576f817a1cd1f7105">XLoader_SecureEncInit()</a>, <a class="el" href="xloader__auth__enc_8h.html#a7d852b900fa863fa8719bba0e2699423">XLoader_SecureValidations()</a>, and <a class="el" href="xloader__secure_8h.html#ade5fc1ce6a279c921672d5692df5cf56">XLoader_SetSecureState()</a>.</p>

</div>
</div>
<a class="anchor" id="a27d4a7f2cecd7b051a5418ad7586cac3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 XLoader_GetSHWRoT </td>
          <td>(</td>
          <td class="paramtype">const u32 *&#160;</td>
          <td class="paramname"><em>SHWRoTPtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the state of encrypted boot. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SHWRoTPtr</td><td>- Always NULL except at time of initialization of SecureStateSHWRoT variable</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XPLMI_RTCFG_SECURESTATE_SHWROT - Any DEC only fuse is programmed</li>
<li>XPLMI_RTCFG_SECURESTATE_EMUL_SHWROT - PLM is encrypted</li>
<li>XPLMI_RTCFG_SECURESTATE_NONSECURE - Neither DEC only fuses are programmed nor PLM is encrypted </li>
</ul>
</dd></dl>
<ul>
<li>If SHWRoTPtr is not NULL, then set the SecureStateSHWRoT. Otherwise return the previous stored Secure state.</li>
</ul>

<p>Referenced by <a class="el" href="net_2xloader__plat__secure_8h.html#a331850d019d28f888cfa3499be80529d">XLoader_AddDeviceStateChangeToScheduler()</a>, <a class="el" href="xloader__auth__enc_8h.html#a9df696fd17dec50576f817a1cd1f7105">XLoader_SecureEncInit()</a>, <a class="el" href="xloader__auth__enc_8h.html#a7d852b900fa863fa8719bba0e2699423">XLoader_SecureValidations()</a>, and <a class="el" href="xloader__secure_8h.html#ade5fc1ce6a279c921672d5692df5cf56">XLoader_SetSecureState()</a>.</p>

</div>
</div>
<a class="anchor" id="a31df7acaead3af0dfa1735979d3cee12"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">XLoader_SecureTempParams* XLoader_GetTempParams </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the pointer to XLoader_SecureTempParams. </p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to XLoader_SecureTempParams </dd></dl>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#aa912487046c04b1c90ca418a19ac3e0d">XLoader_ProcessAuthEncPrtn()</a>, <a class="el" href="xloader__prtn__load_8c.html#a629ebb0c55462b5cde87f7e91037b8c0">XLoader_PrtnCopy()</a>, <a class="el" href="xloader__auth__enc_8h.html#ac4b3b88f124856db12efa0ce4d6c81d0">XLoader_ReadAndVerifySecureHdrs()</a>, <a class="el" href="xloader__auth__enc_8h.html#a5aef75ed3205f50c75189b7c46099856">XLoader_SecureAuthInit()</a>, <a class="el" href="xloader__auth__enc_8h.html#a9df696fd17dec50576f817a1cd1f7105">XLoader_SecureEncInit()</a>, <a class="el" href="xloader__secure_8h.html#a9410756c2dbe4b6bd6cdfce81a5bd7fa">XLoader_SecureInit()</a>, and <a class="el" href="xloader__auth__enc_8h.html#a7d852b900fa863fa8719bba0e2699423">XLoader_SecureValidations()</a>.</p>

</div>
</div>
<a class="anchor" id="a5054d79a7dcc052ae83d997f183c8779"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureChunkCopy </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>SrcAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8&#160;</td>
          <td class="paramname"><em>Last</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>BlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>TotalSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function copies the data from SrcAddr to chunk memory during processing of secure partitions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance </td></tr>
    <tr><td class="paramname">SrcAddr</td><td>is the source address from which the data is to be processed or copied </td></tr>
    <tr><td class="paramname">Last</td><td>notifies if the block to be processed is last or not </td></tr>
    <tr><td class="paramname">BlockSize</td><td>is size of the data block to be processed which doesn't include padding lengths and hash. </td></tr>
    <tr><td class="paramname">TotalSize</td><td>is pointer to TotalSize which has to be processed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_DATA_COPY_FAIL if failed to copy data to PMC RAM. </li>
</ul>
</dd></dl>
<ul>
<li>Copy the next chunk securely, and then wait for the process to be completed.</li>
<li>The following initialization is crucial as the authentication certificate and PUF data are now stored in the PMC RAM instead of the PPU1 RAM. During the processing of the first chunk of any partition, the second 32K chunk of the PMC RAM, starting from 0xf2008120, contains the authentication certificate and PUF data as applicable. As a result, the second chunk of the partition must be loaded at 0xf2000020, not at 0xf2008120. Therefore, double buffering is disabled when processing the first chunk, and only enabled from the second chunk onwards. The third chunk is loaded at 0xf2008120, and from then on, the chunks are loaded alternatively to the two 32KB chunks of the PMC RAM.</li>
</ul>

<p>Referenced by <a class="el" href="xloader__auth__enc_8h.html#aa912487046c04b1c90ca418a19ac3e0d">XLoader_ProcessAuthEncPrtn()</a>.</p>

</div>
</div>
<a class="anchor" id="a9171035e129091fbaddbc27756381f76"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureClear </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is called to clear secure critical data in case of exceptions. </p>
<p>The function also places AES, ECDSA_RSA and SHA3 in reset.</p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_SECURE_CLEAR_FAIL if failed to clear AES, RSA, SHA3 engines. </li>
</ul>
</dd></dl>
<p>Place SHA3 in reset </p>

<p>References <a class="el" href="xloader__auth__enc_8c.html#a22f293db863b881993077e17fc892007">XLoader_AuthEncClear()</a>, <a class="el" href="xloader__secure_8c.html#ae1ad484f4b4344573008a1fa138ad597">XLOADER_SHA3_RESET_REG</a>, and <a class="el" href="xloader__secure_8c.html#a18a802ef19167e4a011890ac7bf61f7d">XLOADER_SHA3_RESET_VAL</a>.</p>

</div>
</div>
<a class="anchor" id="a04bdca8398a9278a9c382ef66ad42ed9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureCopy </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&#160;</td>
          <td class="paramname"><em>DestAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>Size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function loads secure non-cdo partitions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance. </td></tr>
    <tr><td class="paramname">DestAddr</td><td>is load address of the partition. </td></tr>
    <tr><td class="paramname">Size</td><td>is unencrypted size of the partition in bytes.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success and error code on failure </li>
</ul>
</dd></dl>
<ul>
<li>Update the length for last chunk</li>
<li>Process the partition.</li>
<li>Update variables for next chunk</li>
<li>On failure clear data at destination address </li>
</ul>

<p>References <a class="el" href="xloader__plat_8h.html#a3944db2060fd83c89b79580dd0caa0de">XLOADER_SECURE_CHUNK_SIZE</a>.</p>

<p>Referenced by <a class="el" href="xloader__prtn__load_8c.html#a629ebb0c55462b5cde87f7e91037b8c0">XLoader_PrtnCopy()</a>.</p>

</div>
</div>
<a class="anchor" id="a9410756c2dbe4b6bd6cdfce81a5bd7fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SecureInit </td>
          <td>(</td>
          <td class="paramtype">XLoader_SecureParams *&#160;</td>
          <td class="paramname"><em>SecurePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">XilPdi *&#160;</td>
          <td class="paramname"><em>PdiPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>PrtnNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function initializes XLoader_SecureParams's instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">SecurePtr</td><td>is pointer to the XLoader_SecureParams instance. </td></tr>
    <tr><td class="paramname">PdiPtr</td><td>is pointer to the XilPdi instance </td></tr>
    <tr><td class="paramname">PrtnNum</td><td>is the partition number to be processed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on success.</li>
<li>XLOADER_ERR_MEMSET_SECURE_PTR if failed to set memory for secure pointer.</li>
<li>XLOADER_ERR_INIT_GET_DMA if failed to get DMA instance during initialization. </li>
</ul>
</dd></dl>
<ul>
<li>Initialize XLoader_SecureParms instance with zeros.</li>
<li>Initialize XLoader_SecureTempParams instance with zeros.</li>
<li>Read partition header from meta header.</li>
<li>The following initialization is crucial as the authentication certificate and PUF data are now stored in the PMC RAM instead of the PPU1 RAM. During the processing of the first chunk of any partition, the second 32K chunk of the PMC RAM, starting from 0xf2008120, contains the authentication certificate and PUF data as applicable. As a result, the second chunk of the partition must be loaded at 0xf2000020, not at 0xf2008120. Therefore, double buffering is disabled when processing the first chunk, and only enabled from the second chunk onwards. The third chunk is loaded at 0xf2008120, and from then on, the chunks are loaded alternatively to the two 32KB chunks of the PMC RAM.</li>
<li>Get DMA instance</li>
<li>Initialize the checksum.</li>
<li>Initialize the authentication.</li>
<li>Initialize the encryption. </li>
</ul>

<p>References <a class="el" href="xloader__secure_8c.html#a31df7acaead3af0dfa1735979d3cee12">XLoader_GetTempParams()</a>, <a class="el" href="xloader__auth__enc_8c.html#a5aef75ed3205f50c75189b7c46099856">XLoader_SecureAuthInit()</a>, and <a class="el" href="xloader__auth__enc_8c.html#a9df696fd17dec50576f817a1cd1f7105">XLoader_SecureEncInit()</a>.</p>

</div>
</div>
<a class="anchor" id="ade5fc1ce6a279c921672d5692df5cf56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XLoader_SetSecureState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reads the value of PPK efuse bits, DEC only efuse bits and fields in bootheader and accordingly sets the Secure State of boot. </p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>XST_SUCCESS on SUCCESS and error code in case of failure.</li>
</ul>
</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The Secure State of the device will be stored in two 32-bit registers in RTC area of PMCRAM and two global variables -one for authenticated boot and other for encrypted boot, for redundancy. </dd></dl>
<ul>
<li>Check secure state for authentication</li>
<li>Set the secure state for authentication in register and global variable.</li>
<li>Check secure state for encryption.</li>
<li>Read DEC_ONLY efuse bits.</li>
<li>If more than one DEC_ONLY efuse bits are programmed, then set the SHWRoT register.</li>
<li>If none of the DEC_ONLY efuse bits are programmed and PLM is encrypted, then set the SHWRoT register.</li>
<li>If none of the DEC_ONLY efuse bits are programmed and PLM is not encrypted, then set the SHWRoT register.</li>
</ul>

<p>References <a class="el" href="xloader__auth__enc_8h.html#ab971c3f4e75170b57d1f5fdcd51cc092">XLoader_CheckSecureStateAuth()</a>, <a class="el" href="xloader__secure_8h.html#a483a3cd071fb861c4ce0ab0174c8b829">XLOADER_EFUSE_SEC_DEC_MASK</a>, <a class="el" href="xloader__secure_8h.html#a97c1c4a75d3823f9ecaa3d6eb2294e9c">XLOADER_EFUSE_SEC_MISC0_OFFSET</a>, <a class="el" href="xloader__secure_8c.html#a3e99458db1239a8f1bcb70eee9025232">XLoader_GetAHWRoT()</a>, and <a class="el" href="xloader__secure_8c.html#a27d4a7f2cecd7b051a5418ad7586cac3">XLoader_GetSHWRoT()</a>.</p>

<p>Referenced by <a class="el" href="xloader_8c.html#acb10f2e97fecfb15aae4fed081b02502">XLoader_Init()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
	<p class="footer">&copy; Copyright 2015-2022 Xilinx, Inc. All Rights Reserved.</p>
	<p class="footer">&copy; Copyright 2022-2023 Advanced Micro Devices, Inc. All Rights Reserved.</p>
</div>
</body>
</html>
